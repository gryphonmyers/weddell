<!doctype html>
<html>
    <head><title>My App</title></head>
    <body>
        <div id='app'></div>
        <script src='js/weddell-ro+vd.js'></script>
        <script>
            var App = Weddell.classes.App;
            // var Component = Weddell.classes.Component;

            var app = new App({
                routes: [
                    {
                        name: 'homePage',
                        pattern: '/:pageName/:localeCode?',
                        handler: function() {
                            debugger;
                            return 'HomePage'
                        }
                    },
                    {
                        name: 'jonboy',
                        pattern: '/jonboy/',
                        redirect: function(obj) {
                            return obj.fullPath + 'wrong/boy/';
                        },
                        handler: function(obj){
                            return 'MyBodyA'
                        },
                        children: [
                            {
                                name: 'jonboy2',
                                pattern: 'wrong/:bomba/',
                                handler: function(args){
                                    return 'MyBodyB'
                                }
                            },
                            {
                                name: 'windham',
                                pattern: '/dorfo/dongu/:bing',
                                handler: function(args) {
                                    return 'MyBodyC'
                                }
                            }
                        ]
                    }
                ],
                el: '#app',
                // markupRenderFormat: 'HTMLString',
                Component: Component => class AppComponent extends Component {
                    constructor(opts) {
                        super(Object.assign({
                            // markupFormat: '(locals:Object,h:Function)=>HTMLString',
                            styles: `
                                .moo {
                                    background-color: red;
                                }
                            `,
                            markupTemplate: (locals, h) => {
                                var el = h("div", [
                                    h("MyHeader", {
                                        "attributes": {
                                            "bobby": "foot"
                                        }
                                    }, [
                                        h("MyFooter")
                                    ]),
                                    h("h1", `${locals.myAppTitle}`),
                                    h("MyFooter"),
                                    h("Accordion", {
                                        "attributes": {
                                            "type": "radio"
                                        }
                                    }, [
                                        h("AccordionRow", {
                                            "attributes": {
                                                "accordionLabel": "Bringo"
                                            }
                                        }, [
                                            h("h1", `Moooo`),
                                            h('a', {
                                                attributes: {
                                                    href: locals.$routerLink({name: 'jonboy2', params: {bomba: 'dumba'} })
                                                }
                                            },
                                            "This is the link"),
                                            h('a', {
                                                attributes: {
                                                    href: locals.$routerLink({name: 'jonboy', params: {bomba: 'dumba'} })
                                                }
                                            },
                                            "This is the previous link"),
                                            h('a', {
                                                attributes: {
                                                    href: locals.$routerLink({name: 'windham', params: {bing: 'woosh'} })
                                                }
                                            },
                                            "This is a weird link")
                                        ]),
                                        h("AccordionRow", {
                                            "attributes": {
                                                "accordionLabel": "Boppa"
                                            }
                                        }, [
                                            h("span", `Hi omnes lingua, institutis, legibus inter se differunt. Ut enim ad minim veniam, quis nostrud exercitation. Quam diu etiam furor iste tuus nos eludet?`)
                                        ]),
                                        h("AccordionRow", {
                                            "attributes": {
                                                "accordionLabel": "Basdij"
                                            }
                                        }, [
                                            h("span", `Idque Caesaris facere voluntate liceret: sese habere. Vivamus sagittis lacus vel augue laoreet rutrum faucibus. Contra legem facit qui id facit quod lex prohibet.`)
                                        ]),
                                        h("AccordionRow", {
                                            "attributes": {
                                                "accordionLabel": "asdnASKJ"
                                            }
                                        }, [
                                            h("span", `Gallia est omnis divisa in partes tres, quarum. Donec sed odio operae, eu vulputate felis rhoncus. Salutantibus vitae elit libero, a pharetra augue.`)
                                        ])
                                    ]),
                                    h('RouterView')
                                ]);
                                return el;
                            },
                            state: {
                                myAppTitle: 'A compendium of frog species',
                                numberOfThings: 1,
                                appTitlePlusNumThings: function() {
                                    return this.myAppTitle + this.numberOfThings;
                                }
                            },
                            components: {
                                Accordion: Component => class Accordion extends Component {
                                    constructor(opts) {
                                        super(Object.assign({
                                            // markupFormat: '(locals:Object,h:Function)=>HTMLString',
                                            stylesFormat: 'CSSString',
                                            state: {
                                                boogie: 'moo',
                                                accordionID: null,
                                                type: 'checkbox'
                                            },
                                            inputs: ['type'],
                                            markupTemplate: (locals, h) =>
                                                h("div", {
                                                  "attributes": {
                                                    "data-moo": locals.type,
                                                    "class": "accordion-wrapper"
                                                  }
                                                }, [
                                                  h("content")
                                                ]),
                                            styles: `
                                                .accordion-label {
                                                    display: block;
                                                    padding: 10px 40px 10px 15px;
                                                    position: relative;
                                                    margin-bottom: 5px;
                                                    transition: border-bottom 0s 0.5s, margin-bottom 0s 0.5s, background-color 0.5s;
                                                    border: 1px solid #dedede;
                                                }

                                                .accordion-label::after {
                                                    transform: translate(-50%, -50%);
                                                }
                                                .accordion-label::before, .accordion-label::after {
                                                    content: '';
                                                    position: absolute;
                                                    display: block;
                                                    right: 0;
                                                    top: 50%;
                                                    width: 20px;
                                                    height: 2px;
                                                    background-color: $color_4;
                                                    opacity: 1;
                                                    transition: opacity 0.5s;
                                                }

                                                .accordion-label::before {
                                                    transform: translate(-50%, -50%) rotate(90deg);
                                                }

                                                .accordion[type=checkbox]:checked + .accordion-label::before {
                                                    opacity: 0;
                                                }

                                                .accordion[type=radio]:checked + .accordion-label::before,
                                                .accordion[type=radio]:checked + .accordion-label::after {
                                                    opacity: 0;
                                                }

                                                .accordion[type=radio]:not(:checked) + .accordion-label,
                                                .accordion[type=checkbox] + .accordion-label {
                                                    cursor: pointer;
                                                }

                                                .accordion:not(:checked) + .accordion-content,
                                                .accordion:not(:checked) + .accordion-label + .accordion-content {
                                                    max-height: 0;
                                                    border: 0px solid transparent;
                                                    margin-bottom: 0;
                                                }

                                                .accordion:checked + .accordion-content,
                                                .accordion:checked + .accordion-label + .accordion-content{
                                                    max-height: 1500px;
                                                    padding-top: 10px;
                                                    padding-bottom: 10px;
                                                    padding-left: 15px;
                                                    padding-right: 15px;
                                                    transition: max-height 0.5s 0s, padding-left 0s, padding-right 0s, padding-top 0.5s, padding-bottom 0.5s, background-color 0.5s;
                                                }

                                                .accordion:checked + .accordion-label {
                                                    transition: background-color 0.5s;
                                                }

                                                .accordion + .accordion-content,
                                                .accordion + .accordion-label + .accordion-content{
                                                    overflow: hidden;
                                                    background-color: $color_5;
                                                    transition: max-height 0.5s 0s, padding-left 0s 0.5s,  padding-right 0s 0.5s, padding-top 0.5s, padding-bottom 0.5s, border 0s 0.5s, margin-bottom 0s 0.5s, background-color 0.5s;
                                                }

                                                .accordion {
                                                    display: none;
                                                }

                                                .accordion:checked + .accordion-label + .accordion-content {
                                                    border: 1px solid #dedede;
                                                    border-top: none;
                                                    margin-bottom: 5px;
                                                }

                                                .accordion:checked + .accordion-label {
                                                    border-bottom: none;
                                                    margin-bottom: 0;
                                                }

                                                .accordion-content .accordion:checked + .accordion-label,
                                                .accordion-content .accordion:checked + .accordion-label + .accordion-content {
                                                    background-color: #EBEBEB;
                                                }
                                            `,
                                            components: {
                                                AccordionRow: [Component => class AccordionRow extends Component {
                                                    constructor(opts) {
                                                        super(Object.assign({
                                                            inputs: ['type', 'accordionLabel'],
                                                            state: {
                                                                accordionLabel: 'Mew',
                                                                type: 'checkbox'
                                                            },
                                                            // markupFormat: '(locals:Object,h:Function)=>HTMLString',
                                                            markupTemplate: (locals, h) => {
                                                                var el = h("div.accordion-row", {
                                                                    "attributes": {
                                                                    }
                                                                }, [
                                                                    h("input.accordion", {
                                                                        "attributes": {
                                                                            "name": "sections-accordion",
                                                                            "type": locals.type
                                                                        },
                                                                        "id": "accordion-" + locals.$componentID + locals.$id + "-checkbox"
                                                                    }),
                                                                    h("label.accordion-label", {
                                                                        "attributes": {
                                                                            "for": "accordion-" + locals.$componentID + locals.$id + "-checkbox"
                                                                        }
                                                                    }, [
                                                                        h("h3", [
                                                                            h("a", {
                                                                                "attributes": {
                                                                                    "href": "#"
                                                                                }
                                                                            }, `${locals.accordionLabel}`)
                                                                        ])
                                                                    ]),
                                                                    h("div.accordion-content", [
                                                                        h("content")
                                                                    ])
                                                                ]);
                                                                return el;
                                                            }

                                                        }, opts))
                                                    }
                                                }, {
                                                    type: 'type'
                                                }]
                                            }
                                        }, opts));
                                    }
                                },
                                MyHeader: Component => class Header extends Component {
                                    constructor(opts) {
                                        super(Object.assign({
                                            // markupFormat: '(locals:Object,h:Function)=>HTMLString',
                                            markupTemplate: (locals, h) =>
                                                h("header", {
                                                    "attributes": {
                                                        "data-bobby": locals.bobby,
                                                        "onclick": locals.$bind("this.state.numba++")
                                                    }
                                                }, `${locals.headerText + locals.numba}`),
                                            inputs: ['bobby'],
                                            state: {
                                                numba: 1,
                                                headerText: 'Who doesn\'t love frogs?'
                                            }
                                        }, opts))
                                    }
                                    onInit() {
                                        this.on('renderdommarkup', function(){
                                            console.log('rendered dom');
                                        })
                                    }
                                },
                                MyBodyA: Component => class Body extends Component {
                                    constructor(opts) {
                                        super(Object.assign({
                                            markupTemplate: (locals, h) =>
                                                h('div', [
                                                    h('div.mooboody', {
                                                        attributes: {
                                                            onclick: locals.$bind("this.store.$act('disablethings')")
                                                        }
                                                    }, "Don't fuck me on this."),
                                                    h('RouterView')
                                                ]),
                                            components: {
                                                MyBodyB: Component => class Body extends Component {
                                                    constructor(opts) {
                                                        super(Object.assign({
                                                            markupTemplate: (local, h) =>
                                                                h('div.shhsh', "Gosh you're such a millennium.")
                                                        }, opts))
                                                    }
                                                },
                                                MyBodyC: Component => class Body extends Component {
                                                    constructor(opts) {
                                                        super(Object.assign({
                                                            markupTemplate: (local, h) =>
                                                                h('div.whut', "Ho there partner.")
                                                        }, opts))
                                                    }
                                                }
                                            }
                                        }, opts))
                                    }
                                },
                                MyFooter: Component => class Footer extends Component {
                                    constructor(opts) {
                                        super(Object.assign({
                                            // markupFormat: '(locals:Object,h:Function)=>HTMLString',
                                            markupTemplate: (locals, h) =>
                                                h("footer", [
                                                    `${!locals.disabled ? locals.coolContent : ''}`,
                                                    h("div", `${locals.footerText}`)
                                                ]),
                                            state: {
                                                disabled: false,
                                                coolContent: 'This is cool',
                                                footerText: 'Copyright 2016, David Attenborough'
                                            }
                                        }, opts))
                                    }

                                    onInit() {
                                        this.on('disablethings', function(evt){
                                            console.log('Disabling, sorry', evt.mything);
                                            this.state.disabled = true;
                                        });
                                        setTimeout(() => {
                                            this.route('/jonboy/wrong/');//{ name: 'jonboy', params: {bogus: 'prime', dingus:'chonus'} });
                                            this.state.footerText = 'Just kidding, copyright 2017, some other guy';
                                        }, 3000);
                                    }
                                }
                            }
                        }, opts))
                    }
                }
            });
            app.init();
        </script>
    </body>
</html>
